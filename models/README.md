taking code out of ipynb and setting it up to run end to end with unit tests
